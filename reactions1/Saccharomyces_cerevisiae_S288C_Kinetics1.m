function [f,grad] = Saccharomyces_cerevisiae_S288C_Kinetics1(x,model,fixedExch,Sred,kinInactRxns,subunits,flag)
% Pre-allocation of memory
h = 1e-8;
% Defining metabolite and enzyme species
if flag==1
x = x(:);
v = zeros(77,165);
E = zeros(77,165);
x = [x,x(:,ones(1,164)) + diag(h*1i*ones(164,1))];
else
v = zeros(77,size(x,2));
E = zeros(77,size(x,2));
end
% Defining metabolite and enzyme species
m_glc__D_c = x(1,:);
m_atp_c = x(2,:);
m_adp_c = x(3,:);
m_g6p_c = x(4,:);
m_f6p_c = x(5,:);
m_dhap_c = x(6,:);
m_fdp_c = x(7,:);
m_g3p_c = x(8,:);
m_met_13dpg_c = x(9,:);
m_met_23dpg_c = x(10,:);
m_nad_c = x(11,:);
m_nadh_c = x(12,:);
m_acald_c = x(13,:);
m_etoh_c = x(14,:);
m_pyr_c = x(15,:);
m_pyr_m = x(16,:);
m_glyc_c = x(17,:);
m_amp_c = x(18,:);
m_met_3pg_c = x(19,:);
m_met_2pg_c = x(20,:);
m_accoa_c = x(21,:);
m_pep_c = x(22,:);
m_glyc3p_c = x(23,:);
m_coa_m = x(24,:);
m_oaa_c = x(25,:);
m_cit_m = x(26,:);
m_icit_m = x(27,:);
m_akg_m = x(28,:);
m_succoa_m = x(29,:);
m_succ_m = x(30,:);
m_fum_m = x(31,:);
m_mal__L_c = x(32,:);
m_mal__L_m = x(33,:);
m_oaa_m = x(34,:);
m_nad_m = x(35,:);
m_nadh_m = x(36,:);
m_accoa_m = x(37,:);
m_adp_m = x(38,:);
m_atp_m = x(39,:);
m_amp_m = x(40,:);
m_glc__D_e = x(41,:);
m_etoh_e = x(42,:);
m_glyc_e = x(43,:);
m_acald_e = x(44,:);
m_pyr_e = x(45,:);
m_nadp_c = x(46,:);
m_nadph_c = x(47,:);
m_met_6pgl_c = x(48,:);
m_met_6pgc_c = x(49,:);
m_ru5p__D_c = x(50,:);
m_xu5p__D_c = x(51,:);
m_r5p_c = x(52,:);
m_s7p_c = x(53,:);
m_e4p_c = x(54,:);
m_s17bp_c = x(55,:);
m_f1p_c = x(56,:);
m_glyald_c = x(57,:);
m_sdhlam_m = x(58,:);
m_lpam_m = x(59,:);
m_dhlam_m = x(60,:);
m_nadp_m = x(61,:);
m_nadph_m = x(62,:);
m_glyc3p_m = x(63,:);
m_q6h2_m = x(64,:);
m_q6_m = x(65,:);
m_fadh2_m = x(66,:);
m_fad_m = x(67,:);
m_succ_c = x(68,:);
m_fum_c = x(69,:);
m_fum_e = x(70,:);
m_ac_c = x(71,:);
m_coa_c = x(72,:);
m_ac_m = x(73,:);
m_mal__L_e = x(74,:);
m_etoh_m = x(75,:);
m_acald_m = x(76,:);
m_h2o_c = x(77,:);
m_pi_c = x(78,:);
m_h_c = x(79,:);
m_co2_m = x(80,:);
m_co2_c = x(81,:);
m_hco3_c = x(82,:);
m_h_m = x(83,:);
m_h2o_m = x(84,:);
m_pi_m = x(85,:);
m_ppi_c = x(86,:);
m_ppi_m = x(87,:);
E(1,:) = x(88,:);
E(2,:) = x(89,:);
E(3,:) = x(90,:);
E(4,:) = x(91,:);
E(5,:) = x(92,:);
E(6,:) = x(93,:);
E(7,:) = x(94,:);
E(8,:) = x(95,:);
E(9,:) = x(96,:);
E(10,:) = x(97,:);
E(11,:) = x(98,:);
E(12,:) = x(99,:);
E(13,:) = x(100,:);
E(14,:) = x(101,:);
E(15,:) = x(102,:);
E(16,:) = x(103,:);
E(17,:) = x(104,:);
E(18,:) = x(105,:);
E(19,:) = x(106,:);
E(20,:) = x(107,:);
E(21,:) = x(108,:);
E(22,:) = x(109,:);
E(23,:) = x(110,:);
E(24,:) = x(111,:);
E(25,:) = x(112,:);
E(26,:) = x(113,:);
E(27,:) = x(114,:);
E(28,:) = x(115,:);
E(29,:) = x(116,:);
E(30,:) = x(117,:);
E(31,:) = x(118,:);
E(32,:) = x(119,:);
E(33,:) = x(120,:);
E(34,:) = x(121,:);
E(35,:) = x(122,:);
E(36,:) = x(123,:);
E(37,:) = x(124,:);
E(38,:) = x(125,:);
E(39,:) = x(126,:);
E(40,:) = x(127,:);
E(41,:) = x(128,:);
E(42,:) = x(129,:);
E(43,:) = x(130,:);
E(44,:) = x(131,:);
E(45,:) = x(132,:);
E(46,:) = x(133,:);
E(47,:) = x(134,:);
E(48,:) = x(135,:);
E(49,:) = x(136,:);
E(50,:) = x(137,:);
E(51,:) = x(138,:);
E(52,:) = x(139,:);
E(53,:) = x(140,:);
E(54,:) = x(141,:);
E(55,:) = x(142,:);
E(56,:) = x(143,:);
E(57,:) = x(144,:);
E(58,:) = x(145,:);
E(59,:) = x(146,:);
E(60,:) = x(147,:);
E(61,:) = x(148,:);
E(62,:) = x(149,:);
E(63,:) = x(150,:);
E(64,:) = x(151,:);
E(65,:) = x(152,:);
E(66,:) = x(153,:);
E(67,:) = x(154,:);
E(68,:) = x(155,:);
E(69,:) = x(156,:);
E(70,:) = x(157,:);
E(71,:) = x(158,:);
E(72,:) = x(159,:);
E(73,:) = x(160,:);
E(74,:) = x(161,:);
E(75,:) = x(162,:);
E(76,:) = x(163,:);
E(77,:) = x(164,:);
% Reaction rates
v(1,:) = r_GLCt11([m_glc__D_e;m_glc__D_c],model.rxnParams(1).kineticParams);
v(2,:) = r_HEX11([m_atp_c;m_glc__D_c;m_g6p_c;m_adp_c],model.rxnParams(2).kineticParams);
v(3,:) = r_PGI1([m_g6p_c;m_f6p_c],model.rxnParams(3).kineticParams);
v(4,:) = r_PFK1([m_atp_c;m_f6p_c;m_adp_c;m_fdp_c],model.rxnParams(4).kineticParams);
v(5,:) = r_FBP1([m_fdp_c;m_h2o_c;m_f6p_c;m_pi_c],model.rxnParams(5).kineticParams);
v(6,:) = r_FBA1([m_fdp_c;m_dhap_c;m_g3p_c],model.rxnParams(6).kineticParams);
v(7,:) = r_TPI1([m_g3p_c;m_dhap_c],model.rxnParams(7).kineticParams);
v(8,:) = r_GAPD1([m_met_13dpg_c;m_nadh_c;m_h_c;m_g3p_c;m_nad_c;m_pi_c],model.rxnParams(8).kineticParams);
v(9,:) = r_PGK1([m_adp_c;m_met_13dpg_c;m_atp_c;m_met_3pg_c],model.rxnParams(9).kineticParams);
v(10,:) = r_PGM1([m_met_2pg_c;m_met_3pg_c],model.rxnParams(10).kineticParams);
v(11,:) = r_ENO1([m_met_2pg_c;m_pep_c;m_h2o_c],model.rxnParams(11).kineticParams);
v(12,:) = r_PYK1([m_adp_c;m_pep_c;m_atp_c;m_pyr_c],model.rxnParams(12).kineticParams);
v(13,:) = r_PYRt2m1([m_pyr_c;m_pyr_m],model.rxnParams(13).kineticParams);
v(14,:) = r_GLYK1([m_atp_c;m_glyc_c;m_adp_c;m_glyc3p_c],model.rxnParams(14).kineticParams);
v(15,:) = r_PYRDC1([m_pyr_c;m_h_c;m_acald_c;m_co2_c],model.rxnParams(15).kineticParams);
v(16,:) = r_ALCD2x_copy11([m_nadh_c;m_acald_c;m_nad_c;m_etoh_c],model.rxnParams(16).kineticParams);
v(17,:) = r_ETOHt1([m_etoh_c;m_etoh_e],model.rxnParams(17).kineticParams);
v(18,:) = r_ACALDt1([m_acald_c;m_acald_e],model.rxnParams(18).kineticParams);
v(19,:) = r_G3PT1([m_glyc3p_c;m_h2o_c;m_glyc_c;m_pi_c],model.rxnParams(19).kineticParams);
v(20,:) = r_G3PD1ir1([m_dhap_c;m_nadh_c;m_h_c;m_nad_c;m_glyc3p_c],model.rxnParams(20).kineticParams);
v(21,:) = r_GLYCt1([m_glyc_c;m_glyc_e],model.rxnParams(21).kineticParams);
v(22,:) = r_GLYCt21([m_glyc_c;m_glyc_e],model.rxnParams(22).kineticParams);
v(23,:) = r_ACtm1([m_ac_c;m_ac_m],model.rxnParams(23).kineticParams);
v(24,:) = r_PPCK1([m_atp_c;m_oaa_c;m_adp_c;m_pep_c;m_co2_c],model.rxnParams(24).kineticParams);
v(25,:) = r_PDHm1([m_pyr_m;m_coa_m;m_nad_m;m_nadh_m;m_accoa_m;m_co2_m],model.rxnParams(25).kineticParams);
v(26,:) = r_CSm1([m_oaa_m;m_accoa_m;m_h2o_m;m_coa_m;m_cit_m;m_h_m],model.rxnParams(26).kineticParams);
v(27,:) = r_ICDHym1([m_icit_m;m_nadp_m;m_akg_m;m_nadph_m;m_co2_m],model.rxnParams(27).kineticParams);
v(28,:) = r_ACONTm1([m_icit_m;m_cit_m],model.rxnParams(28).kineticParams);
v(29,:) = r_ICDHxm1([m_icit_m;m_nad_m;m_akg_m;m_nadh_m;m_co2_m],model.rxnParams(29).kineticParams);
v(30,:) = r_AKGDam1([m_akg_m;m_lpam_m;m_h_m;m_sdhlam_m;m_co2_m],model.rxnParams(30).kineticParams);
v(31,:) = r_AKGDbm1([m_coa_m;m_sdhlam_m;m_succoa_m;m_dhlam_m],model.rxnParams(31).kineticParams);
v(32,:) = r_SUCOASm1([m_coa_m;m_succ_m;m_atp_m;m_succoa_m;m_adp_m;m_pi_m],model.rxnParams(32).kineticParams);
v(33,:) = r_ME2m1([m_mal__L_m;m_nadp_m;m_pyr_m;m_nadph_m;m_co2_m],model.rxnParams(33).kineticParams);
v(34,:) = r_FUMm1([m_fum_m;m_h2o_m;m_mal__L_m],model.rxnParams(34).kineticParams);
v(35,:) = r_MDH1([m_nadh_c;m_oaa_m;m_nad_c;m_mal__L_c],model.rxnParams(35).kineticParams);
v(36,:) = r_ALDD2xm1([m_nad_m;m_acald_m;m_h2o_m;m_nadh_m;m_ac_m;m_h_m;m_h_m],model.rxnParams(36).kineticParams);
v(37,:) = r_ALDD2y1([m_nadp_m;m_acald_m;m_h2o_c;m_nadph_m;m_ac_m;m_h_c;m_h_c],model.rxnParams(37).kineticParams);
v(38,:) = r_ACS1([m_atp_c;m_ac_c;m_coa_c;m_amp_c;m_accoa_c;m_ppi_c],model.rxnParams(38).kineticParams);
v(39,:) = r_ACSm1([m_coa_m;m_atp_m;m_ac_m;m_accoa_m;m_amp_m;m_ppi_m],model.rxnParams(39).kineticParams);
v(40,:) = r_GCC2cm_copy11([m_nad_m;m_dhlam_m;m_nadh_m;m_lpam_m;m_h_m],model.rxnParams(40).kineticParams);
v(41,:) = r_PC1([m_atp_c;m_pyr_c;m_hco3_c;m_adp_c;m_oaa_c;m_pi_c],model.rxnParams(41).kineticParams);
v(42,:) = r_OAAt2m1([m_oaa_c;m_oaa_m],model.rxnParams(42).kineticParams);
v(43,:) = r_ME1m1([m_mal__L_m;m_nad_m;m_pyr_m;m_nadh_m;m_co2_m],model.rxnParams(43).kineticParams);
v(44,:) = r_ALCD2irm1([m_nadh_m;m_acald_m;m_nad_m;m_etoh_m],model.rxnParams(44).kineticParams);
v(45,:) = r_PYRt21([m_pyr_c;m_pyr_e],model.rxnParams(45).kineticParams);
v(46,:) = r_MALtm1([m_mal__L_m;m_mal__L_c],model.rxnParams(46).kineticParams);
v(47,:) = r_MALt2r1([m_mal__L_c;m_mal__L_e],model.rxnParams(47).kineticParams);
v(48,:) = r_ATPS3m1([m_adp_m;m_pi_c;m_h_c;m_atp_m;m_h2o_c],model.rxnParams(48).kineticParams);
v(49,:) = r_ANT_ADP1([m_adp_c],model.rxnParams(49).kineticParams);
v(50,:) = r_ANT_ATP1([m_atp_m],model.rxnParams(50).kineticParams);
v(51,:) = r_NADH2_u6m1([m_nadh_m;m_q6_m;m_h_m;m_nad_m;m_q6h2_m],model.rxnParams(51).kineticParams);
v(52,:) = r_DPGM1([m_met_13dpg_c;m_met_23dpg_c;m_h_c],model.rxnParams(52).kineticParams);
v(53,:) = r_G6PDH2r1([m_g6p_c;m_nadp_c;m_nadph_c;m_met_6pgl_c;m_h_c],model.rxnParams(53).kineticParams);
v(54,:) = r_PGL1([m_met_6pgl_c;m_h2o_c;m_met_6pgc_c;m_h_c],model.rxnParams(54).kineticParams);
v(55,:) = r_GND1([m_nadp_c;m_met_6pgc_c;m_nadph_c;m_ru5p__D_c;m_co2_c],model.rxnParams(55).kineticParams);
v(56,:) = r_RPE1([m_ru5p__D_c;m_xu5p__D_c],model.rxnParams(56).kineticParams);
v(57,:) = r_RPI1([m_ru5p__D_c;m_r5p_c],model.rxnParams(57).kineticParams);
v(58,:) = r_TKT11([m_xu5p__D_c;m_r5p_c;m_g3p_c;m_s7p_c],model.rxnParams(58).kineticParams);
v(59,:) = r_TKT21([m_xu5p__D_c;m_e4p_c;m_f6p_c;m_g3p_c],model.rxnParams(59).kineticParams);
v(60,:) = r_TALA1([m_f6p_c;m_e4p_c;m_g3p_c;m_s7p_c],model.rxnParams(60).kineticParams);
v(61,:) = r_PFK_31([m_atp_c;m_s7p_c;m_adp_c;m_s17bp_c],model.rxnParams(61).kineticParams);
v(62,:) = r_FBA31([m_dhap_c;m_e4p_c;m_s17bp_c],model.rxnParams(62).kineticParams);
v(63,:) = r_FRUK1([m_atp_c;m_f1p_c;m_adp_c;m_fdp_c],model.rxnParams(63).kineticParams);
v(64,:) = r_FBA21([m_dhap_c;m_glyald_c;m_f1p_c],model.rxnParams(64).kineticParams);
v(65,:) = r_ADK1m1([m_atp_m;m_amp_m;m_adp_m;m_adp_m],model.rxnParams(65).kineticParams);
v(66,:) = r_ADK11([m_atp_c;m_amp_c;m_adp_c;m_adp_c],model.rxnParams(66).kineticParams);
v(67,:) = r_GLYC3Ptm1([m_glyc3p_c],model.rxnParams(67).kineticParams);
v(68,:) = r_SUCD2_u6m1([m_succ_m;m_q6_m;m_fum_m;m_q6h2_m],model.rxnParams(68).kineticParams);
v(69,:) = r_FRDm1([m_fum_m;m_fadh2_m;m_succ_m;m_fad_m],model.rxnParams(69).kineticParams);
v(70,:) = r_SUCD1m1([m_fum_m;m_fadh2_m;m_succ_m;m_fad_m],model.rxnParams(70).kineticParams);
v(71,:) = r_SUCFUMtm1([m_fum_m;m_succ_c;m_succ_m;m_fum_c],model.rxnParams(71).kineticParams);
v(72,:) = r_FUMt2r1([m_fum_c;m_fum_e],model.rxnParams(72).kineticParams);
v(73,:) = r_SUCCtm1([m_succ_m;m_succ_c],model.rxnParams(73).kineticParams);
v(74,:) = r_NADH2_u6cm1([m_nadh_c;m_q6_m;m_nad_c;m_q6h2_m;m_h_c],model.rxnParams(74).kineticParams);
v(75,:) = r_ETOHtm1([m_etoh_c;m_etoh_m],model.rxnParams(75).kineticParams);
v(76,:) = r_Ex_glc1([m_glc__D_e],model.rxnParams(76).kineticParams);
v(77,:) = r_Ex_etoh1([m_etoh_e],model.rxnParams(77).kineticParams);
if flag==1
% Final rates
y = sum((Sred*(E.*v)).^2);
f = real(y(1));
if (nargout>1) % gradient is required
grad = imag(y(2:end))/h;
end
else
f = E.*v;
grad = [];
end